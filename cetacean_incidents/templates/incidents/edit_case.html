{% extends "detail.html" %}

{# TODO this template is a subset of the change_observation template #}

{% block head %}
{{ block.super }}
<script type="text/javascript">
    $(function(){
        var $tabs = $('#tabs').tabs();
        
        $('.link-to-animal').click(function() { // bind click event to link
            $tabs.tabs('select', '#animal'); // switch to animal tab
            return false;
        });
        $('.link-to-case').click(function() { // bind click event to link
            $tabs.tabs('select', '#case'); // switch to case tab
            return false;
        });
        $('.link-to-case-sinmd').click(function() { // bind click event to link
            $tabs.tabs('select', '#case-sinmd'); // switch to case tab
            return false;
        });
        {% block other_tabs_js %}{% endblock %}
    });
</script>
{% endblock %}

{% block title %}{{ block.super }}: {{ case }} [editing]{% endblock %}

{% block ids-dl %}
{% with case.animal as a %}
{% include "incidents/animal_ids_include.html" %}
{% endwith %}
<hr>
{% block case_ids %}
{% with case as c %}
{% include "incidents/case_ids_include.html" %}
{% endwith %}
{% endblock %}
{% endblock %}

{% block header %}
{% if case.ole_investigation %}
{% include "incidents/ole-warning.html" %}
{% endif %}
<h2>{{ animal|default:"<i>new animal</i>" }}</h2>
<h2 style="margin-left:1em;">{{ case }}</h2>
{% endblock %}

{% block content %}
<form action="" method="post">
    <button type="submit">
        save changes to {{ case }} and {{ animal }}
    </button>
    {% csrf_token %}
    <div id="tabs">
        <ul>
            <li{% if forms.animal.errors %} class="ui-state-error"{% endif %}>
                <a href="#animal">
                    <em>Animal</em>
                    <br>&nbsp;
                </a>
            </li>
            <li{% if forms.case.non_field_errors or forms.case.nmfs_id.errors or forms.case.animal.errors or forms.case.happened_after.errors or forms.case.valid.errors or forms.case.ole_investigation.errors %} class="ui-state-error"{% endif %}>
                <a href="#case">
                    <em>Case</em>
                    <br>&nbsp;
                </a>
            </li>
            {% block other_tabs %}{% endblock %}
            <li{% if forms.case.non_field_errors or forms.case.review_1_date.errors or forms.case.review_1_inits.errors or forms.case.review_2_date.errors or forms.case.review_2_inits.errors or forms.case.case_confirm_criteria.errors or forms.case.animal_fate.errors or forms.case.fate_cause.errors or forms.case.fate_cause_indications.errors or forms.case.si_prevented.errors or forms.case.included_in_sar.errors or forms.case.review_1_notes.errors or forms.case.review_2_notes.errors %} class="ui-state-error"{% endif %}>
                <a href="#case-sinmd">
                    <em>Case</em>
                    <br><abbr title="Serious Injury and Mortality Determination">SI&MD</abbr>
                </a>
            </li>
        </ul>

        <div id="animal">
            {% if case.animal.case_set.count > 1 or case.animal.observation_set.count > 1 %}
            <div class="edit-warning">
                <img
                    src="{% url site-media path="icons/warning.png"%}"
                >
                Note that this is the animal data for {% if case.animal.case_set.count > 1 %}{{ case.animal.case_set.count|add:"-1" }} other case{{ case.animal.case_set.count|add:"-1"|pluralize }} and {% endif %} {{ case.animal.observation_set.count }} observation{{ case.animal.observation_set.count|pluralize }}.
                <img
                    src="{% url site-media path="icons/warning.png"%}"
                >
            </div>
            {% endif %}
            {% if forms.animal.non_field_errors %}
            {{ forms.animal.non_field_errors }}
            {% endif %}
            {% for f in forms.animal %}
            {% include "labeled_field.html" %}
            {% endfor %}
            <div style="text-align: right;">
                <a class="link-to-case" href="#case">next tab &#x2192;</a>
            </div>
        </div> <!-- id="animal" -->

        <div id="case">
            {% if case.observation_set.count > 1 %}
            <div class="edit-warning">
                <img
                    src="{% url site-media path="icons/warning.png"%}"
                >
                Note that this is the case data for {{ case.observation_set.count }} observation{{ case.observation_set.count|pluralize }}.
                <img
                    src="{% url site-media path="icons/warning.png"%}"
                >
            </div>
            {{ forms.case.non_field_errors }}
            {% endif %}
            {% with forms.case.nmfs_id as f %}
            {% include "labeled_field.html" %}
            {% endwith %}
            {% with forms.case.animal as f %}
            {% include "labeled_field.html" %}
            {% endwith %}
            {% with forms.case.happened_after as f %}
            {% include "labeled_field.html" %}
            {% endwith %}
            {% with forms.case.valid as f %}
            {% include "labeled_field.html" %}
            {% endwith %}
            {% with forms.case.ole_investigation as f %}
            {% include "labeled_field.html" %}
            {% endwith %}
            <div style="text-align:left; float: left;">
                <a class="link-to-animal" href="#animal">&#x2190; previous tab</a>
            </div>
            <div style="text-align: right;">
                {% block other_tabs_next_link %}<a class="link-to-case-sinmd" href="#case-sinmd">{% endblock %}next tab &#x2192;</a>
            </div>
        </div> <!-- id="case" -->
        
        {% block other_tabs_body %}{% endblock %}

        <div id="case-sinmd">
            {% if case.observation_set.count > 1 %}
            <div class="edit-warning">
                <img
                    src="{% url site-media path="icons/warning.png"%}"
                >
                Note that this is the case data for {{ case.observation_set.count }} observation{{ case.observation_set.count|pluralize }}.
                <img
                    src="{% url site-media path="icons/warning.png"%}"
                >
            </div>
            {{ forms.case.non_field_errors }}
            {% endif %}
            {% with forms.case.review_1_date as f %}
            {% include "labeled_field.html" %}
            {% endwith %}
            {% with forms.case.review_1_inits as f %}
            {% include "labeled_field.html" %}
            {% endwith %}
            {% with forms.case.review_2_date as f %}
            {% include "labeled_field.html" %}
            {% endwith %}
            {% with forms.case.review_2_inits as f %}
            {% include "labeled_field.html" %}
            {% endwith %}
            {% with forms.case.case_confirm_criteria as f %}
            {% include "labeled_field.html" %}
            {% endwith %}
            {% with forms.case.animal_fate as f %}
            {% include "labeled_field.html" %}
            {% endwith %}
            {% with forms.case.fate_cause as f %}
            {% include "labeled_field.html" %}
            {% endwith %}
            {% with forms.case.fate_cause_indications as f %}
            {% include "labeled_field.html" %}
            {% endwith %}
            {% with forms.case.si_prevented as f %}
            {% include "labeled_field.html" %}
            {% endwith %}
            {% with forms.case.included_in_sar as f %}
            {% include "labeled_field.html" %}
            {% endwith %}
            {% with forms.case.review_1_notes as f %}
            {% include "labeled_field.html" %}
            {% endwith %}
            {% with forms.case.review_2_notes as f %}
            {% include "labeled_field.html" %}
            {% endwith %}
            <hr>
            <div style="text-align:left; float: left;">
                {% block other_tabs_prev_link %}<a class="link-to-case" href="#case">{% endblock %}&#x2190; previous tab</a>
            </div>
        </div> <!-- id="case-sinmd" -->
    </div>
</form>
{% endblock %}
