{% extends "detail.html" %}
{% load observation_extras %}
{% load animal_extras %}
{% load contact_extras %}
{% load generic_field_display %}
{% load case_extras %}

{% block head %}
{{ block.super }}
<script type="text/javascript" src="{% url site-media path="sorttable/sorttable.js" %}"></script>
<link rel="stylesheet" type="text/css" href="{% url site-media path="sorttable/sorttable.css" %}">
{% endblock %}

{% block title %}{{ block.super }}: {{ case }}{% endblock %}

{% block ids-dl %}
<dt>local ID</dt><dd>{{ case.id }}</dd>
<dt>current name</dt><dd>{{ case.current_name|default:"<i>none</i>" }}</dd>
{% if case.past_names_set %}
<dt>past names</dt>
<dd>
    {% for past_name in case.past_names_set %}
    {{ past_name }}<br>
    {% endfor %}
</dd>
{% endif %}
<dt>NMFS case number</dt><dd>{{ case.nmfs_id|default:"<i>none</i>" }}</dd>
{% endblock %}

{% block header %}
<div>
    {% if case.ole_investigation %}
    {% include "incidents/ole-warning.html" %}
    {% endif %}
    <h2>{{ case }}</h2>
</div>
{% endblock %}

{% block content %}
{% if case.associated_cases %}
<i>other cases for this animal around this time:</i>
<ul>
    {% for c in case.associated_cases %}
    <li>{% case_link c %}</li>
    {% endfor %}
</ul>
{% endif %}
<div class="section">
    {% block case_fields %}
    <div>
        <span class="fieldname">Animal:</span> {% animal_link case.animal %}
    </div>
    <div>
        <span class="fieldname">Validity:</span>
        {% include "incidents/case-valid-icon.html" %}
        {{ case.get_valid_display }}
    </div>
    {% display_yesnounk_div case "ole_investigation" %}
    {% if case.si_n_m_info %}
    <div class="subsection">
        <h3>Serious Injury and Mortality determination</h3>
        {% display_div case "case_confirm_criteria" %}
        {% display_div case "animal_fate" %}
        {% display_div case "fate_cause" %}
        {% display_div case "fate_cause_indications" %}
        {% display_div case "si_prevented" %}
        {% display_div case "included_in_sar" %}
        <table class="layout" width="100%">
            <tr>
                <th>1<sup>st</sup> reviewer</th>
                <th>2<sup>nd</sup> reviewer</tH>
            </tr>
            <tr>
                <td>
                    {% display_div case "review_1_date" "date" %}
                    {% display_div case "review_1_inits" "initials" %}
                    {% display_bigtext_div case "review_1_notes" "notes" %}
                </td>
                <td>
                    {% display_div case "review_2_date" "date" %}
                    {% display_div case "review_2_inits" "initials" %}
                    {% display_bigtext_div case "review_2_notes" "notes" %}
                </td>
            </tr>
        </table>
    </div>
    {% else %}
    <p>
        <i>no Serious Injury and Mortality info yet</i>
    </p>
    {% endif %}
    {% endblock %}
</div>
{% block extra_case_fields %}{% endblock %}
<div class="section">
    <h3>Observations</h3>
    {% block observations %}
    {% if case.observation_set.count %}
    <table class="sortable">
        <thead>
            <tr>
                <td></td>
                <th sorttable_customkey="{{ observer.sort_name }}">observer</th>
                <th>date observed</th>
                <th sorttable_customkey="{{ observer.sort_name }}">reporter</th>
                <th>date reported</th>
                <th class="sorttable_nosort">start of narrative...</th>
            </tr>
        </thead>
        {% for o in case.observation_set.all %}
        <tr>
            <td>{% observation_link o %}</td>
            <td>{% contact_link o.observer %}</td>
            <td>{{ o.observation_datetime }}</td>
            <td>{% if o.firsthand %}<i>reported by the observer</i>{% else %}{% contact_link o.reporter %}{% endif %}</td>
            <td>{{ o.report_datetime }}</td>
            <td>{% if o.narrative %}{{ o.narrative|truncatewords:9 }}{% else %}<i>nothing</i>{% endif %}</td>
        </tr>
        {% endfor %}
    </table>
    {% else %}
    <i>no observations yet!</i>
    {% endif %}
    {% endblock %}
</div>
{% endblock %}

